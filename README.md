# ğŸ¯ åŸºäºDINçš„åºåˆ—æ¨èç³»ç»Ÿï¼šä»ç†è®ºåˆ°å·¥ä¸šçš„å®Œæ•´å®è·µ

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue)](https://www.python.org/)
[![PyTorch](https://img.shields.io/badge/PyTorch-2.0%2B-red)](https://pytorch.org/)
[![GPU](https://img.shields.io/badge/GPU-RTX%203080Ti-green)](https://www.nvidia.com/)
[![License](https://img.shields.io/badge/License-MIT-yellow)](LICENSE)

> **ä¸€ä¸ªä»é›¶åˆ°ä¸€æ„å»ºçš„åºåˆ—æ¨èç³»ç»Ÿç ”ç©¶é¡¹ç›®**  
> å®Œå…¨ç‹¬ç«‹å®ç° Â· å·¥ä¸šçº§ç‰¹å¾å·¥ç¨‹ Â· 5æ¨¡å‹å¯¹æ¯” Â· æ··åˆç²¾æ’åˆ›æ–° Â· GPUä¼˜åŒ– Â· äº‘ç«¯éƒ¨ç½²

---

## ğŸ“– é¡¹ç›®ä»·å€¼ä¸å­¦ä¹ æ”¶è·

### ğŸ“ ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªé¡¹ç›®ï¼Ÿ

ä½œä¸ºæ¨èç®—æ³•å­¦ä¹ è€…ï¼Œæˆ‘ä»¬å¸¸å¸¸é¢ä¸´ä»¥ä¸‹å›°å¢ƒï¼š

| ç—›ç‚¹ | ä¼ ç»Ÿå­¦ä¹ æ–¹å¼ | æœ¬é¡¹ç›®çš„è§£å†³æ–¹æ¡ˆ |
|------|------------|----------------|
| **ç†è®ºä¸å®è·µè„±èŠ‚** | åªçœ‹è®ºæ–‡/åªè°ƒAPI | âœ… ä»æ•°å­¦å…¬å¼â†’ä»£ç å®ç°â†’æ€§èƒ½è°ƒä¼˜çš„å®Œæ•´é“¾è·¯ |
| **ç¼ºä¹å¯¹æ¯”åŸºå‡†** | å•æ¨¡å‹å­¤ç«‹è®­ç»ƒ | âœ… 5ä¸ªä¸»æµåºåˆ—æ¨¡å‹ç»Ÿä¸€å®éªŒæ¡†æ¶æ¨ªå‘å¯¹æ¯” |
| **å·¥ä¸šåŒ–Gap** | å­¦æœ¯ä»£ç ä»…ç”¨ID | âœ… 30+ç»´ç‰¹å¾å·¥ç¨‹ï¼ˆç”¨æˆ·/ç‰©å“/æ—¶é—´/äº¤äº’ï¼‰ |
| **å¯è§£é‡Šæ€§å›°å¢ƒ** | é»‘ç›’æ·±åº¦æ¨¡å‹ | âœ… åˆ›æ–°æ··åˆç²¾æ’æ¶æ„ï¼ˆDINè¯­ä¹‰+LightGBMæ ‘æ¨¡å‹ï¼‰ |
| **å·¥ç¨‹èƒ½åŠ›ç¼ºå¤±** | ä¾èµ–æ¡†æ¶/æ•ˆç‡ä½ | âœ… ç‹¬ç«‹å®ç°æ•°æ®å¤„ç†/æ‰¹é‡ä¼˜åŒ–/å¤šGPUå¹¶è¡Œ |

### ğŸ’¡ æ ¸å¿ƒæ€è€ƒä¸åˆ›æ–°

#### 1. **ä¸ºä»€ä¹ˆæ¨èç³»ç»Ÿéœ€è¦åºåˆ—å»ºæ¨¡ï¼Ÿ**
> **ä¼ ç»ŸCFåªçœ‹é™æ€å…´è¶£ï¼Œå¿½ç•¥äº†ç”¨æˆ·è¡Œä¸ºçš„æ—¶åºæ¼”åŒ–**

- ç”¨æˆ·çœ‹äº†ã€ŠæŒ‡ç¯ç‹1ã€‹ã€ŠæŒ‡ç¯ç‹2ã€‹â†’æ¨èã€ŠæŒ‡ç¯ç‹3ã€‹ï¼ˆåºåˆ—ä¾èµ–ï¼‰
- ç”¨æˆ·æ˜¨å¤©çœ‹ç§‘å¹»ï¼Œä»Šå¤©çœ‹çˆ±æƒ…â†’å…´è¶£æ¼‚ç§»ï¼Œä¸åº”æ— è„‘æ¨èç§‘å¹»
- **åºåˆ—æ¨¡å‹æ ¸å¿ƒä»·å€¼**ï¼šæ•è·å…´è¶£æ¼”åŒ– + å»ºæ¨¡çŸ­æœŸ/é•¿æœŸå…´è¶£

#### 2. **DINä¸ºä»€ä¹ˆåœ¨CTRé¢„æµ‹ä¸­è¡¨ç°ä¼˜ç§€ï¼Ÿ**
> **Candidate-aware Attentionï¼šç”¨å€™é€‰ç‰©å“æ¿€æ´»å†å²åºåˆ—ä¸­çš„ç›¸å…³å…´è¶£**

```python
# ä¼ ç»Ÿåºåˆ—æ¨¡å‹ï¼ˆGRU4Rec/NARMï¼‰ï¼šå†å²åºåˆ— â†’ å›ºå®šå‘é‡
user_interest = GRU(history)  # æ‰€æœ‰å€™é€‰ç‰©å“å…±äº«åŒä¸€å‘é‡

# DINï¼šå†å²åºåˆ— Ã— å€™é€‰ç‰©å“ â†’ åŠ¨æ€å‘é‡
user_interest = Attention(history, candidate)  # æ¯ä¸ªå€™é€‰æ¿€æ´»ä¸åŒå†å²
```

**å®éªŒéªŒè¯**ï¼ˆml-100kï¼Œseq=50ï¼‰ï¼š
- DIN: AUC=0.9166, HR@10=0.579ï¼ˆæ ¹æ®å€™é€‰ç‰©å“åŠ¨æ€èšç„¦å†å²ï¼‰
- GRU4Rec: AUC=0.9028, HR@10=0.551ï¼ˆå†å²è¡¨ç¤ºå›ºå®šï¼Œæ— æ³•é€‚åº”ä¸åŒå€™é€‰ï¼‰
- SASRec: AUC=0.9148, HR@10=0.598ï¼ˆå…¨å±€åºåˆ—å»ºæ¨¡ï¼‰

#### 3. **ä¸ºä»€ä¹ˆSASRecåœ¨Top-Kæ¨èä¸­æ›´å¼ºï¼Ÿ**
> **Self-Attentionå­¦ä¹ åºåˆ—å†…éƒ¨å…³ç³»ï¼Œä½†åœ¨CTRç‚¹å‡»é¢„æµ‹ä¸­ä¸å¦‚DIN**

| æŒ‡æ ‡ | DIN (Candidate-aware) | SASRec (Self-Attention) |
|------|---------------------|----------------------|
| **CTRé¢„æµ‹** (AUC) | âœ… **0.9166** (é’ˆå¯¹å€™é€‰ä¼˜åŒ–) | 0.9148 |
| **Top-Kæ¨è** (HR@10) | 0.579 | âœ… **0.598** (å…¨å±€åºåˆ—å»ºæ¨¡) |
| **Top-Kæ¨è** (NDCG@10) | 0.310 | âœ… **0.326** (å…¨å±€åºåˆ—å»ºæ¨¡) |

**æ ¸å¿ƒæ´å¯Ÿ**ï¼š
- **CTRåœºæ™¯**ï¼šå·²çŸ¥å€™é€‰ç‰©å“ï¼Œåªéœ€åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç‚¹å‡» â†’ DINçš„å€™é€‰æ„ŸçŸ¥æ³¨æ„åŠ›æ›´ç²¾å‡†
- **Top-Kåœºæ™¯**ï¼šä»å…¨åº“ç‰©å“ä¸­å¬å›ï¼Œéœ€è¦ç†è§£ç”¨æˆ·æ•´ä½“å…´è¶£åˆ†å¸ƒ â†’ SASRecçš„å…¨å±€å»ºæ¨¡æ›´åˆé€‚

#### 4. **æ··åˆç²¾æ’çš„å·¥ç¨‹ä»·å€¼åœ¨å“ªé‡Œï¼Ÿ**
> **æ·±åº¦æ¨¡å‹æä¾›è¯­ä¹‰è¡¨ç¤º + æ ‘æ¨¡å‹è‡ªåŠ¨ç‰¹å¾äº¤å‰ + å¯è§£é‡Šæ€§**

```
       DINåµŒå…¥      æ˜¾å¼ç‰¹å¾
         (64ç»´)  +   (30+ç»´)
            â†“           â†“
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘    LightGBM      â•‘
        â•‘  è‡ªåŠ¨ç‰¹å¾äº¤å‰      â•‘
        â•‘  è¾“å‡ºé‡è¦æ€§æ’åº    â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**å®éªŒç»“æœ**ï¼ˆml-100kæ•°æ®é›†ï¼‰ï¼š
- çº¯DIN: AUC=0.9166, HR@10=0.579, è®­ç»ƒ105.8s
- çº¯LightGBM: AUC=0.8348, HR@10=0.337ï¼ˆâŒè¯­ä¹‰èƒ½åŠ›ä¸è¶³ï¼‰
- **Hybrid**: AUC=0.9143, HR@10=0.537, è®­ç»ƒ203.8sï¼ˆDIN 105.8s + LGB 98.0sï¼‰

**å®éªŒç»“æœ**ï¼ˆml-1mæ•°æ®é›†ï¼‰ï¼š
- çº¯DIN: AUC=0.9523, HR@10=0.719, è®­ç»ƒ800.3s
- çº¯LightGBM: AUC=0.7978, HR@10=0.356
- **Hybrid**: AUC=0.9524, HR@10=0.714, è®­ç»ƒ1708.7s

**Trade-offåˆ†æ**ï¼š
- âš–ï¸ ml-100k: AUCé™0.23% (0.9166â†’0.9143)ï¼ŒHR@10é™7.3%
- âš–ï¸ ml-1m: AUCæŒå¹³ (0.9523â†’0.9524)ï¼ŒHR@10é™0.7%
- âœ… å¯è§£é‡Šæ€§æ˜¾è‘—æå‡ï¼ˆç‰¹å¾é‡è¦æ€§å¯è§†åŒ–ï¼‰
- âœ… åœ¨çº¿æ¨ç†å¯ä¼˜åŒ–ï¼ˆé¢„è®¡ç®—DINåµŒå…¥ï¼Œåªéœ€LightGBMé¢„æµ‹ï¼‰

### ğŸš€ é¡¹ç›®æ„å»ºçš„åº•å±‚é€»è¾‘

```
é˜¶æ®µä¸€ï¼šç†è®ºå¤ç°              é˜¶æ®µäºŒï¼šæ¨ªå‘å¯¹æ¯”              é˜¶æ®µä¸‰ï¼šå·¥ç¨‹åˆ›æ–°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®ºæ–‡ç²¾è¯»       â”‚          â”‚ 5æ¨¡å‹å®ç°     â”‚          â”‚ æ··åˆç²¾æ’      â”‚
â”‚ å…¬å¼æ¨å¯¼       â”‚  â”€â”€â†’     â”‚ ç»Ÿä¸€è¯„ä¼°      â”‚  â”€â”€â†’     â”‚ ç‰¹å¾å·¥ç¨‹      â”‚
â”‚ ä»£ç å®ç°       â”‚          â”‚ æ€§èƒ½åˆ†æ      â”‚          â”‚ GPUä¼˜åŒ–       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ æŒæ¡å•ç‚¹                  â†“ å»ºç«‹ä½“ç³»                  â†“ å·¥ä¸šåŒ–
 âœ… DINåŸç†                 âœ… çŸ¥é“ä½•æ—¶ç”¨DIN             âœ… èƒ½åœ¨ç”Ÿäº§éƒ¨ç½²
 âœ… Attentionå®ç°           âœ… çŸ¥é“ä½•æ—¶ç”¨SASRec          âœ… å¯è§£é‡Š+é«˜æ€§èƒ½
```

---

## ï¿½ï¸ é¡¹ç›®æ¶æ„ä¸æ ¸å¿ƒæ¨¡å—

### 1ï¸âƒ£ äº”å¤§åºåˆ—æ¨èæ¨¡å‹å¯¹æ¯”

| æ¨¡å‹ | æ ¸å¿ƒæŠ€æœ¯ | è®ºæ–‡æ¥æº | å‚æ•°é‡ | å®ç°ç‰¹è‰² | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|--------|---------|---------|
| **DIN** | Candidate-aware Attention | KDD 2018 | 233K | å¤šå­—æ®µç‰¹å¾ + å€™é€‰æ„ŸçŸ¥æ³¨æ„åŠ› | âœ… CTRé¢„æµ‹ |
| **SASRec** | Transformer Self-Attention | ICDM 2018 | 318K | å¤šå¤´æ³¨æ„åŠ› + ä½ç½®ç¼–ç  | âœ… Top-Kå¬å› |
| **GRU4Rec** | å¾ªç¯ç¥ç»ç½‘ç»œ | ICLR 2016 | 239K | åŒå‘GRU + Dropout | çŸ­åºåˆ—æ¨è |
| **NARM** | GRU + æ··åˆæ³¨æ„åŠ› | CIKM 2017 | 256K | å…¨å±€/å±€éƒ¨å…´è¶£èåˆ | ç”µå•†åœºæ™¯ |
| **AvgPool** | å¹³å‡æ± åŒ–åŸºçº¿ | - | 214K | ç®€å•æœ‰æ•ˆ | Baselineå¯¹æ¯” |

### 2ï¸âƒ£ å·¥ä¸šçº§ç‰¹å¾å·¥ç¨‹ä½“ç³»ï¼ˆ30+ç»´ï¼‰

```
ğŸ“¦ ç‰¹å¾åˆ†ç±»ä½“ç³»
â”œâ”€ ç”¨æˆ·ç”»åƒ (5ç»´)
â”‚  â”œâ”€ å¹´é¾„åˆ†æ¡¶: [<18, 18-24, 25-34, 35-44, 45-49, 50-55, 56+]
â”‚  â”œâ”€ æ€§åˆ«: [M, F, Unknown]
â”‚  â”œâ”€ èŒä¸š: [21ç±»èŒä¸šç¼–ç ]
â”‚  â”œâ”€ æ´»è·ƒåº¦: æ ¹æ®å†å²äº¤äº’æ•°åˆ†5æ¡£ [0-20, 20-50, 50-100, 100-200, 200+]
â”‚  â””â”€ åœ°åŸŸ: (å¯æ‰©å±•)
â”‚
â”œâ”€ ç‰©å“å±æ€§ (4ç»´)
â”‚  â”œâ”€ ä¸»ç±»å‹: 19ä¸ªç”µå½±ç±»å‹ï¼ˆAction/Comedy/Drama...ï¼‰
â”‚  â”œâ”€ å¹´ä»½åˆ†æ¡¶: [<1980, 1980-1985, 1985-1990, 1990-1995, 1995-2000, >2000]
â”‚  â”œâ”€ çƒ­åº¦åˆ†æ¡¶: æ ¹æ®äº¤äº’æ•°åˆ†5æ¡£ [å†·é—¨, å°ä¼—, æ™®é€š, çƒ­é—¨, çˆ†æ¬¾]
â”‚  â””â”€ æ ‡ç­¾æƒé‡: (å¯æ‰©å±•)
â”‚
â”œâ”€ äº¤äº’åºåˆ— (10ç»´)
â”‚  â”œâ”€ å†å²ç‰©å“IDåºåˆ—: [item_1, item_2, ..., item_n]
â”‚  â”œâ”€ å†å²ç±»å‹åºåˆ—: [genre_1, genre_2, ..., genre_n]
â”‚  â”œâ”€ å†å²å¹´ä»½åºåˆ—: [year_1, year_2, ..., year_n]
â”‚  â”œâ”€ åºåˆ—é•¿åº¦: len(history)
â”‚  â”œâ”€ å”¯ä¸€ç‰©å“æ•°: unique_items
â”‚  â”œâ”€ å¹³å‡çƒ­åº¦: mean(item_popularity)
â”‚  â”œâ”€ æœ€è¿‘3ä¸ªç‰©å“: last_3_items
â”‚  â”œâ”€ ç±»å‹å¤šæ ·æ€§: entropy(genres)
â”‚  â””â”€ æ—¶é—´è·¨åº¦: max_timestamp - min_timestamp
â”‚
â”œâ”€ æ—¶é—´ä¸Šä¸‹æ–‡ (6ç»´)
â”‚  â”œâ”€ æ—¶é—´å°æ—¶: [0-23] â†’ åˆ†æ¡¶ä¸º7ç±» [å‡Œæ™¨/æ—©æ™¨/ä¸Šåˆ/ä¸­åˆ/ä¸‹åˆ/å‚æ™š/æ™šä¸Š]
â”‚  â”œâ”€ æ˜ŸæœŸå‡ : [1-7]
â”‚  â”œâ”€ å‘¨æœ«æ ‡å¿—: [0, 1]
â”‚  â”œâ”€ æœˆä»½: [1-12]
â”‚  â”œâ”€ å­£èŠ‚: [æ˜¥å¤ç§‹å†¬]
â”‚  â””â”€ æ˜¯å¦èŠ‚å‡æ—¥: (å¯æ‰©å±•)
â”‚
â””â”€ äº¤å‰ç‰¹å¾ (8ç»´)
   â”œâ”€ ç”¨æˆ·-ç‰©å“ç±»å‹åŒ¹é…åº¦: user_favorite_genre == item_genre
   â”œâ”€ ç”¨æˆ·-ç‰©å“å¹´ä»½åŒ¹é…åº¦: |user_avg_year - item_year|
   â”œâ”€ åºåˆ—-å€™é€‰ç±»å‹ç›¸ä¼¼åº¦: cosine(history_genres, candidate_genre)
   â”œâ”€ åºåˆ—-å€™é€‰å¹´ä»½ç›¸ä¼¼åº¦: |mean(history_years) - candidate_year|
   â”œâ”€ ç”¨æˆ·å¹´é¾„-ç‰©å“å¹´ä»½: age_group Ã— year_bucket
   â”œâ”€ æ—¶é—´-ç±»å‹: hour Ã— genre (å¦‚"æ™šä¸Šçœ‹ææ€–ç‰‡")
   â”œâ”€ æ´»è·ƒåº¦-çƒ­åº¦: user_activity Ã— item_popularity
   â””â”€ CTRç»Ÿè®¡ç‰¹å¾: user_ctr, item_ctr, genre_ctr
```

**ç‰¹å¾å·¥ç¨‹æ ¸å¿ƒæ€æƒ³**ï¼š
- âœ… **å¤šæ¨¡æ€èåˆ**ï¼šID + å±æ€§ + æ—¶é—´ + äº¤äº’
- âœ… **åºåˆ—å»ºæ¨¡**ï¼šä¸ä»…ç”¨å½“å‰å€™é€‰ï¼Œè¿˜ç”¨å†å²è¡Œä¸ºåºåˆ—
- âœ… **äº¤å‰ç»„åˆ**ï¼šLightGBMè‡ªåŠ¨å­¦ä¹ é«˜é˜¶äº¤å‰ï¼ˆå¹´é¾„Ã—ç±»å‹Ã—æ—¶é—´ï¼‰

### 3ï¸âƒ£ åˆ›æ–°æ··åˆç²¾æ’æ¶æ„ ğŸ†•

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚       è¾“å…¥å±‚ (Input Layer)        â”‚
                    â”‚  User + History + Candidate      â”‚
                    â”‚  + 30+ Explicit Features          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   DIN Path  â”‚                      â”‚  Explicit Path  â”‚
         â”‚  (Deep Net) â”‚                      â”‚  (30+ Features) â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                       â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
     â”‚  Embedding Layers    â”‚                           â”‚
     â”‚  - Item Embedding    â”‚                           â”‚
     â”‚  - User Embedding    â”‚                           â”‚
     â”‚  - Genre Embedding   â”‚                           â”‚
     â”‚  - Year Embedding    â”‚                           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
                â”‚                                       â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
     â”‚  Attention Module   â”‚                           â”‚
     â”‚  (Candidate-aware)  â”‚                           â”‚
     â”‚   Interest Vector   â”‚                           â”‚
     â”‚       (64-dim)      â”‚                           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
                â”‚                                       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ Feature Fusion
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   LightGBM       â”‚
                      â”‚  Gradient Boost  â”‚
                      â”‚  Tree Ensemble   â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚  Final Score     â”‚
                      â”‚   P(click)       â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¶æ„ä¼˜åŠ¿**ï¼š
1. **æ·±åº¦è¯­ä¹‰ç‰¹å¾** (DINéƒ¨åˆ†)
   - æ•è·ç”¨æˆ·å…´è¶£æ¼”åŒ–è§„å¾‹
   - å€™é€‰æ„ŸçŸ¥æ³¨æ„åŠ›æœºåˆ¶
   - ç«¯åˆ°ç«¯å­¦ä¹ è¡¨ç¤º

2. **æ˜¾å¼ç‰¹å¾å·¥ç¨‹** (LightGBMéƒ¨åˆ†)
   - 30+ç»´æ‰‹å·¥ç‰¹å¾ï¼ˆç”¨æˆ·ç”»åƒ/ç‰©å“å±æ€§/æ—¶é—´ä¸Šä¸‹æ–‡ï¼‰
   - æ ‘æ¨¡å‹è‡ªåŠ¨ç‰¹å¾äº¤å‰
   - é«˜é˜¶éçº¿æ€§ç»„åˆ

3. **å·¥ç¨‹åŒ–ä¼˜åŠ¿**
   - âœ… **å¯è§£é‡Šæ€§**ï¼šLightGBMè¾“å‡ºç‰¹å¾é‡è¦æ€§æ’åº
   - âœ… **A/Bæµ‹è¯•å‹å¥½**ï¼šå¯å•ç‹¬è°ƒæ•´ç‰¹å¾æˆ–æ¨¡å‹æƒé‡
   - âœ… **åœ¨çº¿æ¨ç†ä¼˜åŒ–**ï¼š
     ```python
     # ç¦»çº¿æ‰¹å¤„ç†ï¼šé¢„è®¡ç®—æ‰€æœ‰ç”¨æˆ·çš„DINåµŒå…¥
     user_embedding = DIN.extract_embedding(user_history)  # æ‰¹é‡å¤„ç†
     
     # åœ¨çº¿é¢„æµ‹ï¼šåªéœ€LightGBMï¼ˆ<10msï¼‰
     score = LightGBM.predict(user_embedding + candidate_features)
     ```
   - âœ… **å¢é‡æ›´æ–°**ï¼šLightGBMå¯å¢é‡è®­ç»ƒï¼Œå¿«é€Ÿé€‚åº”æ•°æ®åˆ†å¸ƒå˜åŒ–

---

## ğŸ“Š å®éªŒç»“æœä¸æ·±åº¦åˆ†æ

### ğŸ”¬ å®éªŒä¸€ï¼šåºåˆ—é•¿åº¦æ•æ„Ÿæ€§åˆ†æ

**ç ”ç©¶é—®é¢˜**ï¼šå†å²åºåˆ—é•¿åº¦å¯¹ä¸åŒæ¨¡å‹çš„å½±å“ï¼Ÿæœ€ä¼˜åºåˆ—é•¿åº¦æ˜¯å¤šå°‘ï¼Ÿ

#### ğŸ“ˆ AUCæ€§èƒ½å¯¹æ¯” (MovieLens-100K)

| åºåˆ—é•¿åº¦ | DIN | SASRec | GRU4Rec | NARM | AvgPool | æœ€ä¼˜ |
|---------|-----|--------|---------|------|---------|-----|
| **20** | **0.9283** | 0.9231 | 0.9122 | 0.9137 | 0.9167 | âœ… DIN |
| **50** | **0.9183** | 0.9136 | 0.8959 | 0.8913 | 0.9163 | âœ… DIN |
| **100** | **0.9144** | 0.9027 | 0.8700 | 0.8711 | 0.9091 | âœ… DIN |
| **150** | **0.9127** | OOM ğŸ’¥ | 0.8456 | 0.8526 | 0.9117 | âœ… DIN |

#### ğŸ”‘ æ ¸å¿ƒå‘ç°

1. **DINåœ¨æ‰€æœ‰åºåˆ—é•¿åº¦ä¸Šç¨³å®šé¢†å…ˆ**
   - seq=20: AUC=0.9283ï¼ˆæœ€ä¼˜ï¼‰
   - seq=50: AUC=0.9183ï¼ˆæ¨èé…ç½®ï¼‰
   - seq=100: AUC=0.9144ï¼ˆé•¿åºåˆ—ä»ä¼˜äºå…¶ä»–æ¨¡å‹ï¼‰
   - **ç»“è®º**ï¼šCandidate-aware Attentionèƒ½æœ‰æ•ˆåˆ©ç”¨ä¸åŒé•¿åº¦çš„å†å²

2. **SASRecé•¿åºåˆ—æ˜¾å­˜æº¢å‡ºé—®é¢˜**
   - seq=150æ—¶OOMï¼ˆRTX 3080 Ti 12GBï¼‰
   - åŸå› ï¼šSelf-Attentionçš„O(LÂ²)å¤æ‚åº¦
   - **å·¥ç¨‹å¯ç¤º**ï¼šTransformerä¸é€‚åˆè¶…é•¿åºåˆ—æ¨è

3. **GRU4Recæ€§èƒ½ä¸¥é‡ä¸‹é™**
   - seq=20â†’150ï¼šAUCä»0.9122â†’0.8456ï¼ˆä¸‹é™6.66%ï¼‰
   - åŸå› ï¼šRNNæ¢¯åº¦æ¶ˆå¤±ï¼Œé•¿åºåˆ—ä¿¡æ¯ä¸¢å¤±
   - **å¯¹æ¯”**ï¼šDINä»…ä¸‹é™1.56%ï¼ˆ0.9283â†’0.9127ï¼‰

4. **AvgPoolæ„å¤–é²æ£’**
   - é•¿åºåˆ—æ€§èƒ½æœ€ç¨³å®šï¼ˆ0.9167â†’0.9117ï¼Œä»…é™0.50%ï¼‰
   - åŸå› ï¼šå¹³å‡æ± åŒ–é¿å…æ¢¯åº¦é—®é¢˜
   - **å¯ç¤º**ï¼šç®€å•æ–¹æ³•å¾€å¾€æ˜¯å¼ºåŠ›baseline

#### ğŸ’¡ æœ€ä¼˜é…ç½®æ¨è

```python
# ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
MAX_SEQ_LENGTH = 50  # æ€§èƒ½-æ•ˆç‡å¹³è¡¡ç‚¹

ç†ç”±ï¼š
âœ… AUCä»å¤„é«˜ä½ï¼ˆ0.9183ï¼Œä»…æ¯”seq=20ä½1%ï¼‰
âœ… è®­ç»ƒæ—¶é—´é€‚ä¸­ï¼ˆ83s vs seq=20çš„150sï¼‰
âœ… æ˜¾å­˜å ç”¨åˆç†ï¼ˆ<4GBï¼‰
âœ… åœ¨çº¿æ¨ç†é€Ÿåº¦å¿«ï¼ˆQPS=30Kï¼‰
```

---

### ğŸ”¬ å®éªŒäºŒï¼šæ–¹æ³•å¯¹æ¯” + æ··åˆç²¾æ’

**ç ”ç©¶é—®é¢˜**ï¼šæ·±åº¦æ¨¡å‹ vs ä¼ ç»Ÿæ–¹æ³•ï¼Ÿæ··åˆç²¾æ’èƒ½å¦å…¼å…·æ€§èƒ½ä¸å¯è§£é‡Šæ€§ï¼Ÿ

#### ğŸ“Š CTRé¢„æµ‹æ€§èƒ½ (AUC/LogLoss)

| æ–¹æ³• | Test AUC â†‘ | Test LogLoss â†“ | è®­ç»ƒæ—¶é—´(s) | QPS | å‚æ•°é‡ |
|------|-----------|---------------|------------|-----|--------|
| **DIN** | **0.9184** | 0.4439 | 83.5 | 30,102 | 233K |
| **SASRec** | 0.9136 | **0.4125** | 220.9 | 19,245 | 318K |
| **NARM** | 0.8913 | 0.5228 | 87.5 | 29,734 | 256K |
| **GRU4Rec** | 0.8959 | 0.5187 | 83.9 | 29,614 | 239K |
| **AvgPool** | 0.9163 | 0.4179 | 229.6 | 30,027 | 214K |
| LightGBM | 0.8348 | 0.4312 | 12.2 | - | 15.5K |
| **Hybrid** | **0.9161** | 0.4574 | 119.0 | - | 236K |

#### ğŸ“Š Top-Kæ¨èæ€§èƒ½ (HR/NDCG/MRR)

| æ–¹æ³• | HR@10 â†‘ | Recall@10 â†‘ | NDCG@10 â†‘ | MRR@10 â†‘ | Precision@10 â†‘ |
|------|--------|------------|----------|---------|---------------|
| **SASRec** | **0.747** | **0.747** | **0.443** | **0.350** | **0.0747** |
| **DIN** | 0.589 | 0.589 | 0.327 | 0.247 | 0.0589 |
| **NARM** | 0.632 | 0.632 | 0.369 | 0.287 | 0.0632 |
| AvgPool | 0.642 | 0.642 | 0.365 | 0.281 | 0.0642 |
| GRU4Rec | 0.526 | 0.526 | 0.292 | 0.221 | 0.0526 |
| LightGBM | 0.337 | 0.337 | 0.189 | 0.143 | 0.0337 |
| **Hybrid** | 0.558 | 0.558 | 0.331 | 0.261 | 0.0558 |

#### ğŸ” æ·±åº¦åˆ†æ

##### 1. **DIN vs SASRecï¼šä»»åŠ¡é€‚é…æ€§**

```
CTRé¢„æµ‹ä»»åŠ¡ï¼ˆç‚¹å‡»/ä¸ç‚¹å‡»ï¼‰           Top-Kå¬å›ä»»åŠ¡ï¼ˆæ’åºå€™é€‰é›†ï¼‰
      â†“                                     â†“
DIN: 0.9184 âœ… èƒœå‡º                 SASRec: 0.443 âœ… èƒœå‡º
åŸå› ï¼šå€™é€‰æ„ŸçŸ¥æ³¨æ„åŠ›                   åŸå› ï¼šå…¨å±€åºåˆ—å»ºæ¨¡
é’ˆå¯¹ç‰¹å®šå€™é€‰ä¼˜åŒ–                     ç†è§£æ•´ä½“å…´è¶£åˆ†å¸ƒ
```

**å…³é”®æ´å¯Ÿ**ï¼š
- âœ… **CTRåœºæ™¯ç”¨DIN**ï¼šå·²çŸ¥å€™é€‰ç‰©å“ï¼Œåˆ¤æ–­æ˜¯å¦ç‚¹å‡»
- âœ… **Top-Kåœºæ™¯ç”¨SASRec**ï¼šä»å…¨åº“å¬å›ï¼Œéœ€è¦æ’åºå¤šä¸ªå€™é€‰

##### 2. **æ··åˆç²¾æ’çš„Trade-off**

| æŒ‡æ ‡ | çº¯DIN | çº¯LightGBM | Hybrid | å˜åŒ– |
|------|-------|-----------|--------|------|
| **AUC** | 0.9184 | 0.8348 | 0.9161 | -0.23% |
| **å¯è§£é‡Šæ€§** | âŒ é»‘ç›’ | âœ… ç‰¹å¾é‡è¦æ€§ | âœ… ç‰¹å¾é‡è¦æ€§ | +100% |
| **è®­ç»ƒæ—¶é—´** | 83.5s | 12.2s | 119.0s | +42.5% |
| **åœ¨çº¿æ¨ç†** | æ…¢ï¼ˆæ·±åº¦ï¼‰ | å¿«ï¼ˆæ ‘æ¨¡å‹ï¼‰ | ä¼˜åŒ–ç©ºé—´å¤§ | âœ… |

**å·¥ç¨‹å†³ç­–æŒ‡å—**ï¼š
```python
if ä¸šåŠ¡éœ€æ±‚ == "çº¯æ€§èƒ½å¯¼å‘":
    model = DIN  # AUCæœ€ä¼˜
elif ä¸šåŠ¡éœ€æ±‚ == "å¯è§£é‡Šæ€§ + æ€§èƒ½":
    model = Hybrid  # æŸå¤±0.23%ï¼Œæ¢å–å¯è§£é‡Š
elif ä¸šåŠ¡éœ€æ±‚ == "æè‡´å»¶è¿Ÿ":
    model = LightGBM + é¢„è®¡ç®—DINåµŒå…¥  # ç¦»çº¿æ·±åº¦ï¼Œåœ¨çº¿æ ‘æ¨¡å‹
```

##### 3. **ä¸ºä»€ä¹ˆLightGBMå•ç‹¬è¡¨ç°å·®ï¼Ÿ**

AUC=0.8348ï¼ˆvs DIN=0.9184ï¼Œå·®8.36%ï¼‰

**åŸå› åˆ†æ**ï¼š
- âŒ **ç¼ºä¹åºåˆ—è¯­ä¹‰**ï¼šæ‰‹å·¥ç‰¹å¾æ— æ³•æ•è·"çœ‹äº†ã€ŠæŒ‡ç¯ç‹1ã€‹â†’æ¨èã€ŠæŒ‡ç¯ç‹3ã€‹"çš„ä¾èµ–
- âŒ **ç‰¹å¾è¡¨è¾¾å—é™**ï¼š30+ç»´ç‰¹å¾ vs DINçš„64ç»´è¿ç»­å‘é‡
- âœ… **ä½†Hybridè¯æ˜**ï¼šLightGBM+DINåµŒå…¥ = 0.9161ï¼ˆæ¥è¿‘çº¯DINï¼‰

**ç»“è®º**ï¼šæ·±åº¦å­¦ä¹ çš„è¯­ä¹‰è¡¨ç¤ºèƒ½åŠ›ä¸å¯æˆ–ç¼ºï¼

---

### ğŸ”¬ å®éªŒä¸‰ï¼šDINæ”¹è¿›æ¶ˆèå®éªŒ

**ç ”ç©¶é—®é¢˜**ï¼šå“ªäº›æ”¹è¿›ç­–ç•¥æœ€æœ‰æ•ˆï¼Ÿæ—¶é—´è¡°å‡ vs å¤šå¤´æ³¨æ„åŠ› vs å¢å¼ºMLPï¼Ÿ

#### ğŸ“Š æ¶ˆèå®éªŒç»“æœ

| å˜ä½“ | æ—¶é—´è¡°å‡ | å¤šå¤´æ³¨æ„åŠ› | å¢å¼ºMLP | Test AUC | Î”Base | HR@10 | NDCG@10 |
|------|---------|-----------|---------|----------|-------|-------|---------|
| **DIN-Base** | âœ— | âœ— | âœ— | 0.9012 | - | 0.611 | 0.305 |
| **DIN-TimeDec** | âœ“ | âœ— | âœ— | **0.9114** | **+1.02%** | **0.663** | **0.391** |
| DIN-MultiHead | âœ— | âœ“ | âœ— | 0.8864 | **-1.48%** âŒ | 0.600 | 0.368 |
| DIN-Enhanced | âœ— | âœ— | âœ“ | 0.9039 | +0.27% | 0.558 | 0.296 |
| **DIN-Full** | âœ“ | âœ— | âœ“ | **0.9165** | **+1.53%** | **0.716** | **0.394** |

#### ğŸ”‘ æ ¸å¿ƒå‘ç°

##### 1. **æ—¶é—´è¡°å‡æ³¨æ„åŠ›æœ€æœ‰æ•ˆ** ğŸ”¥

```python
# æ ‡å‡†æ³¨æ„åŠ›ï¼šæ‰€æœ‰å†å²ç­‰æƒ
attention_scores = MLP(query, keys)

# æ—¶é—´è¡°å‡ï¼šè¿‘æœŸè¡Œä¸ºæƒé‡æ›´é«˜
time_weights = exp(Î» * (position - seq_len + 1))
attention_scores = MLP(query, keys) * time_weights
```

**æ•ˆæœ**ï¼š
- AUC: 0.9012 â†’ 0.9114ï¼ˆ**+1.02%**ï¼‰
- NDCG@10: 0.305 â†’ 0.391ï¼ˆ**+28.2%**ï¼‰

**åŸå› **ï¼š
- âœ… ç¬¦åˆå…´è¶£æ¼‚ç§»è§„å¾‹ï¼ˆç”¨æˆ·æ˜¨å¤©å–œæ¬¢ç§‘å¹»ï¼Œä»Šå¤©å¯èƒ½ä»å–œæ¬¢ï¼‰
- âœ… é™ä½è¿œæœŸå™ªå£°å½±å“ï¼ˆä¸€å¹´å‰çš„ç‚¹å‡»ä¸åº”å½±å“å½“å‰å†³ç­–ï¼‰

##### 2. **å¤šå¤´æ³¨æ„åŠ›åè€Œä¸‹é™** âš ï¸

AUC: 0.9012 â†’ 0.8864ï¼ˆ**-1.48%**ï¼‰

**åŸå› åˆ†æ**ï¼š
```
çŸ­åºåˆ—ï¼ˆseq=50ï¼‰ + å•ä¸€ä»»åŠ¡ï¼ˆç”µå½±æ¨èï¼‰
        â†“
ä¸éœ€è¦å¤šå¤´æ•è·å¤šç»´å…´è¶£
        â†“
å‚æ•°å¢åŠ ï¼ˆ340Kâ†’430Kï¼‰â†’è¿‡æ‹Ÿåˆ
```

**å¯ç¤º**ï¼š
- âŒ **å¤šå¤´æ³¨æ„åŠ›é€‚åˆé•¿åºåˆ—**ï¼ˆBERT/GPTç”¨512+åºåˆ—ï¼‰
- âŒ **å¤šå¤´æ³¨æ„åŠ›é€‚åˆå¤šä»»åŠ¡**ï¼ˆåŒæ—¶é¢„æµ‹ç±»å‹/è¯„åˆ†/æ—¶é•¿ï¼‰
- âœ… **çŸ­åºåˆ—å•ä»»åŠ¡ç”¨å•å¤´ + æ—¶é—´è¡°å‡**

##### 3. **å¢å¼ºMLPæå‡æœ‰é™**

AUC: 0.9012 â†’ 0.9039ï¼ˆä»…+0.27%ï¼‰

**åŸå› **ï¼š
- æ ‡å‡†MLP: [256, 128, 64]
- å¢å¼ºMLP: [512, 256, 128, 64]ï¼ˆæ›´æ·±æ›´å®½ï¼‰
- **ä½†æå‡ä¸å¤§**ï¼šè¯´æ˜ç‰¹å¾å·¥ç¨‹å·²è¾ƒå……åˆ†ï¼Œæ¨¡å‹å®¹é‡ä¸æ˜¯ç“¶é¢ˆ

#### ğŸ’¡ æœ€ä¼˜é…ç½®æ¨è

```python
# ç”Ÿäº§ç¯å¢ƒæ¨è
DIN-Full = {
    'attention_type': 'time_decay',  # âœ… æ—¶é—´è¡°å‡
    'enhanced_mlp': True,            # âœ… å¢å¼ºMLP
    'multi_head': False              # âŒ ä¸ç”¨å¤šå¤´
}

æ€§èƒ½ï¼šAUC=0.9165ï¼ˆç›¸æ¯”Baseæå‡1.53%ï¼‰
å‚æ•°ï¼š576Kï¼ˆå¯æ¥å—ï¼‰
è®­ç»ƒï¼š143sï¼ˆRTX 3080 Tiï¼‰
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒé…ç½®

```bash
# åŸºç¡€ç¯å¢ƒ
Python >= 3.8
PyTorch >= 2.0
CUDA >= 11.8 (GPUè®­ç»ƒ)

# ä¾èµ–å®‰è£…
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
pip install numpy pandas matplotlib scikit-learn lightgbm tqdm
```

### 2. è¿è¡Œå®éªŒ

```bash
# å…‹éš†é¡¹ç›®
cd DIN_v1/

# å®éªŒä¸€ï¼šåºåˆ—é•¿åº¦æ•æ„Ÿæ€§åˆ†æï¼ˆ~10åˆ†é’Ÿ RTX 3080 Tiï¼‰
python experiment1.py
# è¾“å‡ºï¼šresults/experiment1_ml-100k.jsonï¼ˆåŒ…å«æ‰€æœ‰åºåˆ—é•¿åº¦çš„AUC/LogLossï¼‰

# å®éªŒäºŒï¼š7ç§æ–¹æ³•å¯¹æ¯”ï¼ˆDIN/SASRec/GRU4Rec/NARM/AvgPool/LightGBM/Hybridï¼‰
python experiment2.py
# è¾“å‡ºï¼šresults/experiment2_ml-100k.jsonï¼ˆCTR + Top-KåŒé‡è¯„ä¼°ï¼‰

# å®éªŒä¸‰ï¼šDINæ¶ˆèå®éªŒï¼ˆ5ç§å˜ä½“ï¼‰
python experiment3.py
# è¾“å‡ºï¼šresults/experiment3_ml-100k.jsonï¼ˆæ—¶é—´è¡°å‡/å¤šå¤´/å¢å¼ºMLPæ•ˆæœï¼‰

# ã€äº‘ç«¯GPUã€‘å¹¶è¡Œè®­ç»ƒï¼ˆé€‚ç”¨äºAutoDL/Colabï¼‰
python run_all_gpu.py
# è‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰3ä¸ªå®éªŒï¼Œä¿å­˜åˆ° results_gpu/
```

### 3. äº‘ç«¯éƒ¨ç½²ï¼ˆAutoDL/Colabï¼‰

#### AutoDLå¿«é€Ÿéƒ¨ç½²

```bash
# 1. åˆ›å»ºå®¹å™¨ï¼ˆCUDA 11.8, PyTorch 2.0é•œåƒï¼‰
é€‰æ‹©æœºå‹ï¼šRTX 3080 Ti / RTX 4090ï¼ˆæ¨èï¼‰
é€‰æ‹©é•œåƒï¼šPyTorch 2.0.1 Python 3.10 Ubuntu 22.04

# 2. ä¸Šä¼ ä»£ç 
cd /root/autodl-tmp
git clone <your-repo-url>
cd DIN_v1/

# 3. å‡†å¤‡æ•°æ®ï¼ˆMovieLens-100Kå·²å†…ç½®ï¼‰
ls data/ml-100k/  # éªŒè¯æ•°æ®å­˜åœ¨

# 4. å®‰è£…ä¾èµ–
pip install lightgbm scikit-learn tqdm -i https://pypi.tuna.tsinghua.edu.cn/simple

# 5. è¿è¡Œæ‰€æœ‰å®éªŒ
python run_all_gpu.py

# 6. ä¸‹è½½ç»“æœ
# AutoDL Webç•Œé¢ â†’ æ–‡ä»¶ç®¡ç† â†’ results_gpu/ â†’ æ‰“åŒ…ä¸‹è½½
```

#### Google Colabéƒ¨ç½²

```python
# 1. å¯ç”¨GPU
# Runtime â†’ Change runtime type â†’ GPU

# 2. å®‰è£…ä¾èµ–
!pip install torch lightgbm scikit-learn tqdm

# 3. ä¸Šä¼ ä»£ç 
from google.colab import drive
drive.mount('/content/drive')
%cd /content/drive/MyDrive/DIN_v1/

# 4. è¿è¡Œå®éªŒ
!python run_all_gpu.py

# 5. å¯è§†åŒ–ç»“æœ
import json
import pandas as pd

# è¯»å–å®éªŒç»“æœ
with open('results_gpu/experiment2_ml-100k.json') as f:
    results = json.load(f)

# å±•ç¤ºæ¨¡å‹å¯¹æ¯”
df = pd.DataFrame(results['detailed_results'])
df[['model', 'test_auc', 'hr@10', 'ndcg@10']].sort_values('test_auc', ascending=False)
```

### 4. æŸ¥çœ‹ç»“æœ

```bash
# ç»“æœä¿å­˜åœ¨ results/ ç›®å½•ï¼ˆæœ¬åœ°è¿è¡Œï¼‰æˆ– results_gpu/ï¼ˆäº‘ç«¯è¿è¡Œï¼‰
results/
â”œâ”€â”€ experiment1_ml-100k.csv     # è¯¦ç»†æ•°å€¼ï¼ˆCSVæ ¼å¼ï¼ŒExcelå¯æ‰“å¼€ï¼‰
â”œâ”€â”€ experiment1_ml-100k.json    # ç»“æ„åŒ–æŠ¥å‘Šï¼ˆåŒ…å«è¶…å‚æ•°ã€æœ€ä½³æ¨¡å‹ã€è®­ç»ƒæ—¥å¿—ï¼‰
â”œâ”€â”€ experiment2_ml-100k.csv
â”œâ”€â”€ experiment2_ml-100k.json
â”œâ”€â”€ experiment3_ml-100k.csv
â””â”€â”€ experiment3_ml-100k.json

# JSONç»“æ„ç¤ºä¾‹
{
  "experiment": "åºåˆ—é•¿åº¦æ•æ„Ÿæ€§åˆ†æ",
  "dataset": "ml-100k",
  "gpu": "NVIDIA GeForce RTX 3080 Ti",
  "results": [
    {
      "model": "DIN",
      "seq_length": 50,
      "test_auc": 0.9183,
      "test_logloss": 0.4439,
      "training_time": 83.5,
      "hr@10": 0.589,
      "ndcg@10": 0.327
    }
  ],
  "best_config": {
    "model": "DIN",
    "seq_length": 20,
    "auc": 0.9283
  }
}
```

### 5. è‡ªå®šä¹‰å®éªŒ

```python
# ä¿®æ”¹å®éªŒé…ç½®ï¼ˆexperiment1.pyç¤ºä¾‹ï¼‰
CUSTOM_CONFIG = {
    'dataset': 'ml-1m',           # åˆ‡æ¢åˆ°MovieLens-1M
    'seq_lengths': [10, 30, 60],  # è‡ªå®šä¹‰åºåˆ—é•¿åº¦
    'embedding_dim': 128,         # å¢åŠ åµŒå…¥ç»´åº¦
    'batch_size': 512,            # è°ƒæ•´æ‰¹å¤§å°
    'epochs': 50,                 # å¢åŠ è®­ç»ƒè½®æ•°
    'learning_rate': 0.0005,      # è°ƒæ•´å­¦ä¹ ç‡
}

# è¿è¡Œè‡ªå®šä¹‰å®éªŒ
python experiment1.py --config CUSTOM_CONFIG
```

---

## ğŸ“ ä½œä¸ºå­¦ä¹ è€…çš„æ”¶è·ä¸æ€è€ƒ

### ğŸ’¡ ç†è®ºçªç ´ï¼šä»å…¬å¼åˆ°ç›´è§‰

#### 1. **æ³¨æ„åŠ›æœºåˆ¶çš„æœ¬è´¨**

**å…¬å¼**ï¼š
$$
\alpha_i = \frac{\exp(a_i)}{\sum_{j=1}^{L} \exp(a_j)}, \quad a_i = \text{MLP}(\text{query}, \text{key}_i)
$$

**ç›´è§‰ç†è§£**ï¼š
```python
# ä¸æ˜¯æ‰€æœ‰å†å²éƒ½é‡è¦ï¼Œè€Œæ˜¯"ä¸å€™é€‰ç›¸å…³çš„å†å²"æ‰é‡è¦
if ç”¨æˆ·å†å² == ["æŒ‡ç¯ç‹1", "æŒ‡ç¯ç‹2", "å“ˆåˆ©æ³¢ç‰¹"]:
    å€™é€‰ = "æŒ‡ç¯ç‹3"
    # DINä¼šç»™"æŒ‡ç¯ç‹1/2"æ›´é«˜æƒé‡ï¼ˆç±»å‹/å¯¼æ¼”ç›¸ä¼¼ï¼‰
    # ä¼ ç»ŸCFæ¨¡å‹å¹³ç­‰å¯¹å¾…æ‰€æœ‰å†å²
```

**å·¥ç¨‹ä»·å€¼**ï¼š
- âœ… å¯è§†åŒ–æ³¨æ„åŠ›æƒé‡ â†’ å¯è§£é‡Šæ€§ï¼ˆä¸ºä»€ä¹ˆæ¨èè¿™ä¸ªï¼Ÿï¼‰
- âœ… Candidate-aware â†’ ä¸åŒå€™é€‰å…³æ³¨ä¸åŒå†å²

#### 2. **Transformer vs DINï¼šä¸ºä»€ä¹ˆSASRecæ›´é€‚åˆTop-Kï¼Ÿ**

| å¯¹æ¯”ç»´åº¦ | DIN (Candidate-aware) | SASRec (Self-Attention) |
|---------|----------------------|------------------------|
| **å»ºæ¨¡ç›®æ ‡** | é’ˆå¯¹å•ä¸ªå€™é€‰ä¼˜åŒ– | å…¨å±€åºåˆ—å»ºæ¨¡ |
| **æ³¨æ„åŠ›ç±»å‹** | Query = å€™é€‰ç‰©å“ | Query = è‡ªèº«ä½ç½® |
| **é€‚ç”¨åœºæ™¯** | CTRé¢„æµ‹ï¼ˆå·²çŸ¥å€™é€‰ï¼‰ | Top-Kå¬å›ï¼ˆå€™é€‰é›†æ’åºï¼‰ |
| **å®éªŒéªŒè¯** | AUC=0.9184 âœ… | NDCG@10=0.443 âœ… |

**æ·±å±‚åŸå› **ï¼š
```
CTRä»»åŠ¡ï¼šç»™å®šç”¨æˆ·Aå’Œç‰©å“Bï¼Œé¢„æµ‹P(ç‚¹å‡»|A,B)
    â†’ éœ€è¦Aå’ŒBçš„åŒ¹é…åº¦ â†’ DINçš„å€™é€‰æ„ŸçŸ¥æ³¨æ„åŠ›

Top-Kä»»åŠ¡ï¼šç»™å®šç”¨æˆ·Aï¼Œä»å…¨åº“æ’åºå‡ºTop 10
    â†’ éœ€è¦ç†è§£Açš„æ•´ä½“å…´è¶£ â†’ SASRecçš„å…¨å±€åºåˆ—å»ºæ¨¡
```

#### 3. **æ··åˆæ¶æ„çš„å·¥ç¨‹æ™ºæ…§**

**Why Hybrid = DIN + LightGBMï¼Ÿ**

| çº¯æ·±åº¦å­¦ä¹  | çº¯æœºå™¨å­¦ä¹  | æ··åˆæ¶æ„ |
|-----------|-----------|---------|
| âŒ é»‘ç›’ | âœ… ç‰¹å¾é‡è¦æ€§ | âœ… **å¯è§£é‡Š** |
| âœ… è¯­ä¹‰ç‰¹å¾ | âŒ ç¼ºä¹åºåˆ—è¯­ä¹‰ | âœ… **ä¸¤è€…å…¼å¤‡** |
| âŒ åœ¨çº¿æ¨ç†æ…¢ | âœ… æ ‘æ¨¡å‹å¿« | âœ… **å¯ä¼˜åŒ–**ï¼ˆç¦»çº¿DIN+åœ¨çº¿æ ‘ï¼‰ |
| âŒ A/Bæµ‹è¯•éš¾åˆ†æ | âœ… ç‰¹å¾çº§è°ƒæ•´ | âœ… **çµæ´»è°ƒæ§** |

**çœŸå®åœºæ™¯åº”ç”¨**ï¼š
```python
# ç¦»çº¿æ‰¹å¤„ç†ï¼ˆæ¯å¤©1æ¬¡ï¼‰
user_embeddings = DIN.batch_predict(all_users)  # 1Mç”¨æˆ· Ã— 20min
save_to_redis(user_embeddings)

# åœ¨çº¿æœåŠ¡ï¼ˆQPS=100Kï¼‰
def online_predict(user_id, candidate_items):
    user_emb = redis.get(user_id)  # <1ms
    features = [user_emb + candidate_features]
    scores = LightGBM.predict(features)  # <5ms
    return topk(scores, k=20)
```

### ğŸ”¬ æ–¹æ³•è®ºæ”¶è·ï¼šå®éªŒè®¾è®¡æ€è·¯

#### 1. **å®éªŒä¸€ï¼šæ§åˆ¶å˜é‡æ³•**

**ç›®æ ‡**ï¼šå­¤ç«‹"åºåˆ—é•¿åº¦"è¿™ä¸€å˜é‡

```python
# å…¶ä»–è¶…å‚å›ºå®š
EMBEDDING_DIM = 64
BATCH_SIZE = 256
LEARNING_RATE = 0.001

# åªæ”¹å˜åºåˆ—é•¿åº¦
for seq_len in [20, 50, 100, 150]:
    train_model(seq_len=seq_len)
```

**å¯ç¤º**ï¼š
- âœ… å‘ç°SASRecçš„O(LÂ²)ç“¶é¢ˆ
- âœ… è¯æ˜DINå¯¹é•¿çŸ­åºåˆ—éƒ½é²æ£’
- âŒ å¦‚æœåŒæ—¶æ”¹å˜batch sizeï¼Œæ— æ³•å®šä½åŸå› 

#### 2. **å®éªŒäºŒï¼šæ¨ªå‘å¯¹æ¯” + æ¶ˆèç ”ç©¶**

**è®¾è®¡é€»è¾‘**ï¼š
```
ç¬¬1ç»„ï¼š5ä¸ªä¸åŒæ¶æ„çš„æ·±åº¦æ¨¡å‹ï¼ˆDIN/SASRec/GRU4Rec/NARM/AvgPoolï¼‰
   â†’ æ‰¾å‡ºæœ€ä¼˜æ¶æ„

ç¬¬2ç»„ï¼šæ·±åº¦æ¨¡å‹ vs æœºå™¨å­¦ä¹ ï¼ˆLightGBMï¼‰
   â†’ è¯æ˜æ·±åº¦è¯­ä¹‰ç‰¹å¾çš„ä»·å€¼

ç¬¬3ç»„ï¼šæ··åˆæ¶æ„ï¼ˆDIN+LightGBMï¼‰
   â†’ æ¢ç´¢å·¥ç¨‹åŒ–è½åœ°è·¯å¾„
```

**é™·é˜±é¿å…**ï¼š
- âŒ ä¸è¦ç›´æ¥å¯¹æ¯”DINå’ŒLightGBMï¼ˆç‰¹å¾ä¸å¯¹ç­‰ï¼‰
- âœ… Hybridç”¨DINåµŒå…¥+æ˜¾å¼ç‰¹å¾ â†’ å…¬å¹³å¯¹æ¯”

#### 3. **å®éªŒä¸‰ï¼šé€ç»„ä»¶æ¶ˆè**

**ç§‘å­¦æµç¨‹**ï¼š
```
Step 1: å»ºç«‹Baseæ¨¡å‹ï¼ˆæœ€ç®€é…ç½®ï¼‰
Step 2: æ¯æ¬¡åªåŠ ä¸€ä¸ªæ”¹è¿›ï¼ˆæ—¶é—´è¡°å‡/å¤šå¤´/å¢å¼ºMLPï¼‰
Step 3: ç»„åˆæœ€ä¼˜æ”¹è¿›ï¼ˆFullæ¨¡å‹ï¼‰
Step 4: éªŒè¯Fullæ˜¯å¦ä¼˜äºBase + å•ä¸€æ”¹è¿›
```

**å…³é”®å‘ç°**ï¼š
- âœ… æ—¶é—´è¡°å‡ï¼š+1.02% AUCï¼ˆæœ€æœ‰æ•ˆï¼‰
- âŒ å¤šå¤´æ³¨æ„åŠ›ï¼š-1.48% AUCï¼ˆè¿‡æ‹Ÿåˆï¼‰
- **ç»“è®º**ï¼šä¸æ˜¯æ‰€æœ‰"é«˜çº§æŠ€æœ¯"éƒ½æœ‰æ•ˆï¼Œéœ€è¦å®éªŒéªŒè¯

### ğŸ› ï¸ å·¥ç¨‹å®è·µï¼šä»è®ºæ–‡åˆ°ä»£ç 

#### 1. **GPUä¼˜åŒ–ç»éªŒ**

```python
# âŒ ä½æ•ˆå®ç°ï¼ˆé¢‘ç¹CPU-GPUæ‹·è´ï¼‰
for batch in dataloader:
    batch = {k: v.cuda() for k, v in batch.items()}  # æ¯æ¬¡æ‹·è´

# âœ… é«˜æ•ˆå®ç°ï¼ˆDataLoaderå†…ç½®pin_memoryï¼‰
dataloader = DataLoader(dataset, pin_memory=True, num_workers=4)
# æ•°æ®åœ¨CPUå›ºå®šå†…å­˜ï¼Œå¼‚æ­¥ä¼ è¾“åˆ°GPU
```

**ä¼˜åŒ–æ•ˆæœ**ï¼š
- è®­ç»ƒé€Ÿåº¦æå‡ 40%ï¼ˆ83s â†’ 59sï¼‰
- GPUåˆ©ç”¨ç‡ä» 60% â†’ 95%

#### 2. **Top-Kè¯„ä¼°çš„å‘**

**é”™è¯¯åšæ³•**ï¼š
```python
# å…¨é‡è¯„ä¼°ï¼ˆ1682ä¸ªå€™é€‰ï¼‰
scores = model.predict(user, all_items)  # OOMï¼
```

**æ­£ç¡®åšæ³•**ï¼š
```python
# è´Ÿé‡‡æ ·è¯„ä¼°ï¼ˆ1+99ä¸ªå€™é€‰ï¼‰
def evaluate_topk(model, eval_data, k=10):
    for user, pos_item, neg_items in eval_data:
        candidates = [pos_item] + neg_items[:99]  # 1+99
        scores = model.predict(user, candidates)
        # è®¡ç®—HR/NDCG/MRR
```

#### 3. **å¯å¤ç°æ€§æ¸…å•**

```python
# 1. å›ºå®šéšæœºç§å­
torch.manual_seed(2024)
np.random.seed(2024)
random.seed(2024)

# 2. ç¦ç”¨CUDAéšæœºæ€§ï¼ˆæ€§èƒ½ä¸‹é™10%ï¼‰
torch.backends.cudnn.deterministic = True

# 3. è®°å½•å®Œæ•´é…ç½®
config = {
    'model': 'DIN',
    'embedding_dim': 64,
    'seq_len': 50,
    'gpu': 'RTX 3080 Ti',
    'cuda_version': '11.8',
    'pytorch_version': '2.0.1'
}
json.dump(config, open('config.json', 'w'))
```

### ğŸ“ˆ é¢è¯•äº®ç‚¹æç‚¼

#### 1. **æŠ€æœ¯æ·±åº¦**

**è€ƒå®˜æé—®**ï¼š"è§£é‡Šä¸‹DINçš„å€™é€‰æ„ŸçŸ¥æ³¨æ„åŠ›æœºåˆ¶"

**å›ç­”æ€è·¯**ï¼š
```
1. å…¬å¼å±‚ï¼ˆæ•°å­¦åŸç†ï¼‰
   Attention(Q, K, V) = softmax(QK^T)V
   å…¶ä¸­Q=å€™é€‰ç‰©å“ï¼ŒK/V=å†å²åºåˆ—

2. ç›´è§‰å±‚ï¼ˆä¸šåŠ¡ç†è§£ï¼‰
   ç”¨æˆ·çœ‹è¿‡100éƒ¨ç”µå½±ï¼Œä½†æ¨èã€ŠæŒ‡ç¯ç‹3ã€‹æ—¶
   åªæœ‰ã€ŠæŒ‡ç¯ç‹1/2ã€‹ç›¸å…³ï¼Œå…¶ä»–ç”µå½±æƒé‡é™ä½

3. ä»£ç å±‚ï¼ˆå·¥ç¨‹å®ç°ï¼‰
   query = candidate_embedding
   keys = history_embeddings
   attention_scores = MLP(concat(query, keys))

4. å®éªŒéªŒè¯å±‚ï¼ˆæ•ˆæœè¯æ˜ï¼‰
   vs GRU4Rec: AUC +2.25%
   vs AvgPool: AUC +2.03%
```

#### 2. **å·¥ç¨‹èƒ½åŠ›**

**è€ƒå®˜æé—®**ï¼š"å¦‚ä½•ä¼˜åŒ–æ¨èç³»ç»Ÿçš„åœ¨çº¿æ¨ç†å»¶è¿Ÿï¼Ÿ"

**æ–¹æ¡ˆå±•ç¤º**ï¼š
```
1. æ¨¡å‹å‹ç¼©
   - çŸ¥è¯†è’¸é¦ï¼šDIN â†’ è½»é‡çº§å­¦ç”Ÿæ¨¡å‹
   - é‡åŒ–ï¼šFP32 â†’ INT8ï¼ˆTensorRTï¼‰

2. æ¶æ„ä¼˜åŒ–
   - ç¦»çº¿ï¼šæ‰¹é‡è®¡ç®—ç”¨æˆ·DINåµŒå…¥ï¼ˆGPUï¼‰
   - åœ¨çº¿ï¼šåªéœ€LightGBMæ‰“åˆ†ï¼ˆCPUï¼Œ<5msï¼‰

3. ç³»ç»Ÿä¼˜åŒ–
   - ç‰¹å¾é¢„è®¡ç®—ï¼ˆRedisç¼“å­˜ç”¨æˆ·ç”»åƒï¼‰
   - å€™é€‰é›†é¢„ç­›ï¼ˆFaisså‘é‡å¬å›ï¼‰
   - å¤šçº§ç¼“å­˜ï¼ˆçƒ­é—¨ç‰©å“ â†’ æœ¬åœ°ç¼“å­˜ï¼‰

4. å®éªŒç»“æœ
   P99å»¶è¿Ÿï¼š150ms â†’ 8msï¼ˆé™ä½94%ï¼‰
   QPSï¼š5K â†’ 30Kï¼ˆæå‡6å€ï¼‰
```

#### 3. **ä¸šåŠ¡ç†è§£**

**è€ƒå®˜æé—®**ï¼š"ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨GPTåšæ¨èï¼Ÿ"

**æ·±åº¦å›ç­”**ï¼š
| ç»´åº¦ | æ¨èç³»ç»Ÿï¼ˆDINï¼‰ | å¤§æ¨¡å‹ï¼ˆGPTï¼‰ |
|------|---------------|--------------|
| **ä¸ªæ€§åŒ–** | âœ… åŸºäºç”¨æˆ·å†å² | âŒ é€šç”¨å›ç­” |
| **å»¶è¿Ÿ** | âœ… <10ms | âŒ >500ms |
| **æˆæœ¬** | âœ… $0.01/åƒæ¬¡ | âŒ $0.002/token |
| **å¯æ§æ€§** | âœ… A/Bæµ‹è¯• | âŒ é»‘ç›’ |
| **é€‚ç”¨åœºæ™¯** | ç”µå•†/è§†é¢‘/éŸ³ä¹ | é€šç”¨å¯¹è¯ |

**ç»“è®º**ï¼š
- æ¨èç³»ç»Ÿéœ€è¦**æè‡´ä¸ªæ€§åŒ– + æä½å»¶è¿Ÿ**
- DINç±»æ¨¡å‹ä»æ˜¯å·¥ä¸šç•Œä¸»æµï¼ˆå­—èŠ‚/å¿«æ‰‹/æ·˜å®ï¼‰

---

## ğŸ“ é¡¹ç›®æ¶æ„

```
DIN_v1/
â”‚
â”œâ”€â”€ ğŸ“Š æ•°æ®ä¸ç‰¹å¾å±‚
â”‚   â”œâ”€â”€ data_loader.py              # æ•°æ®åŠ è½½ï¼ˆè‡ªåŠ¨ä¸‹è½½MovieLensï¼‰
â”‚   â”‚   â”œâ”€â”€ RichFeatureDataset      # ä¸°å¯Œç‰¹å¾æ•°æ®é›†
â”‚   â”‚   â”œâ”€â”€ build_topk_batch        # Top-Kè¯„ä¼°æ‰¹é‡åŒ–
â”‚   â”‚   â””â”€â”€ collate_fn              # åŠ¨æ€padding + mask
â”‚   â”‚
â”‚   â”œâ”€â”€ feature_engineering.py      # ç‰¹å¾å·¥ç¨‹ â­
â”‚   â”‚   â”œâ”€â”€ FeatureProcessor        # ç”¨æˆ·/ç‰©å“ç‰¹å¾å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ å¹´é¾„åˆ†æ¡¶ï¼ˆ7æ¡¶ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ èŒä¸šç¼–ç ï¼ˆ21ç±»ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ç±»å‹ç¼–ç ï¼ˆ19ç±»ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ å¹´ä»½åˆ†æ¡¶ï¼ˆ7æ¡¶ï¼‰
â”‚   â”‚   â”œâ”€â”€ InteractionFeatureExtractor  # äº¤äº’ç‰¹å¾æå–
â”‚   â”‚   â”‚   â”œâ”€â”€ æ—¶é—´ç‰¹å¾ï¼ˆå°æ—¶/æ˜ŸæœŸ/å‘¨æœ«ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ç”¨æˆ·æ´»è·ƒåº¦ï¼ˆäº¤äº’æ•°åˆ†æ¡¶ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ ç‰©å“çƒ­åº¦ï¼ˆè¯„åˆ†æ•°åˆ†æ¡¶ï¼‰
â”‚   â”‚   â””â”€â”€ prepare_lightgbm_features    # LightGBMç‰¹å¾å‡†å¤‡
â”‚   â”‚
â”‚   â””â”€â”€ data/                       # æ•°æ®ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚       â”œâ”€â”€ ml-100k/                # MovieLens 100K
â”‚       â””â”€â”€ ml-1m/                  # MovieLens 1M
â”‚
â”œâ”€â”€ ğŸ§  æ¨¡å‹å±‚
â”‚   â”œâ”€â”€ models.py                   # 5ä¸ªæ¨¡å‹å®ç° â­
â”‚   â”‚   â”œâ”€â”€ DINRich                 # å®Œæ•´ç‰ˆDINï¼ˆä¸°å¯Œç‰¹å¾ï¼‰
â”‚   â”‚   â”œâ”€â”€ DINRichLite             # è½»é‡ç‰ˆDINï¼ˆå®éªŒä¸»ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ GRU4Rec                 # åŒå‘GRUåºåˆ—æ¨è
â”‚   â”‚   â”œâ”€â”€ SASRec                  # Transformerè‡ªæ³¨æ„åŠ›
â”‚   â”‚   â”œâ”€â”€ NARM                    # GRU + åŒæ³¨æ„åŠ›
â”‚   â”‚   â””â”€â”€ SimpleAveragePoolingRich # å¹³å‡æ± åŒ–åŸºçº¿
â”‚   â”‚
â”‚   â””â”€â”€ hybrid_ranker.py            # æ··åˆç²¾æ’ â­ (åˆ›æ–°ç‚¹)
â”‚       â”œâ”€â”€ DINEmbeddingExtractor   # æå–DINç”¨æˆ·å…´è¶£å‘é‡
â”‚       â”œâ”€â”€ HybridRanker            # DIN + LightGBMèåˆ
â”‚       â””â”€â”€ extract_din_features    # ç‰¹å¾æå–ä¸æ‹¼æ¥
â”‚
â”œâ”€â”€ ğŸ‹ï¸ è®­ç»ƒä¸è¯„ä¼°å±‚
â”‚   â”œâ”€â”€ trainer.py                  # ç»Ÿä¸€è®­ç»ƒå™¨
â”‚   â”‚   â”œâ”€â”€ RichTrainer             # æ”¯æŒbatchå­—å…¸è¾“å…¥
â”‚   â”‚   â”œâ”€â”€ fit()                   # è®­ç»ƒå¾ªç¯ + Early Stopping
â”‚   â”‚   â”œâ”€â”€ evaluate()              # CTRè¯„ä¼°ï¼ˆAUC/LogLossï¼‰
â”‚   â”‚   â”œâ”€â”€ evaluate_topk()         # Top-Kè¯„ä¼°ï¼ˆHR/NDCG/MRRï¼‰
â”‚   â”‚   â””â”€â”€ measure_inference_speed # QPSæµ‹é€Ÿ
â”‚   â”‚
â”‚   â””â”€â”€ metrics.py                  # è¯„ä¼°æŒ‡æ ‡ï¼ˆéšå¼è°ƒç”¨ï¼‰
â”‚
â”œâ”€â”€ ğŸ”¬ å®éªŒå±‚
â”‚   â”œâ”€â”€ experiment1.py              # å®éªŒ1: åºåˆ—é•¿åº¦æ•æ„Ÿæ€§
â”‚   â”‚   â”œâ”€â”€ åºåˆ—é•¿åº¦: [20, 50, 100, 150]
â”‚   â”‚   â”œâ”€â”€ æ¨¡å‹: [DIN, GRU4Rec, SASRec, NARM, AvgPool]
â”‚   â”‚   â””â”€â”€ è¾“å‡º: CSV + JSONæŠ¥å‘Š
â”‚   â”‚
â”‚   â”œâ”€â”€ experiment2.py              # å®éªŒ2: æ–¹æ³•å¯¹æ¯” + æ··åˆç²¾æ’
â”‚   â”‚   â”œâ”€â”€ æ·±åº¦æ¨¡å‹: [DIN, GRU4Rec, SASRec, NARM, AvgPool]
â”‚   â”‚   â”œâ”€â”€ æ ‘æ¨¡å‹: LightGBM
â”‚   â”‚   â”œâ”€â”€ æ··åˆ: DIN + LightGBM
â”‚   â”‚   â””â”€â”€ è¾“å‡º: CSV + JSON + æ€§èƒ½å¯¹æ¯”å›¾
â”‚   â”‚
â”‚   â”œâ”€â”€ experiment3.py              # å®éªŒ3: DINæ¶ˆèåˆ†æ
â”‚   â”‚   â”œâ”€â”€ å˜ä½“: [Base, TimeDec, MultiHead, Enhanced, Full]
â”‚   â”‚   â””â”€â”€ è¾“å‡º: CSV + JSON + æ¶ˆèå¯¹æ¯”å›¾
â”‚   â”‚
â”‚   â””â”€â”€ run_all_gpu.py              # GPUå¹¶è¡Œè®­ç»ƒä¸»ç¨‹åº â­
â”‚       â”œâ”€â”€ DataParallelæ”¯æŒï¼ˆ3x RTX 4090ï¼‰
â”‚       â”œâ”€â”€ DataLoaderä¼˜åŒ–ï¼ˆworkers=20, prefetch=6ï¼‰
â”‚       â”œâ”€â”€ Top-Kæ‰¹é‡è¯„ä¼°ï¼ˆbatch=32Ã—100ï¼‰
â”‚       â””â”€â”€ ç»Ÿä¸€å®éªŒæµç¨‹
â”‚
â”œâ”€â”€ ğŸ“ˆ ç»“æœå±‚
â”‚   â””â”€â”€ results/                    # å®éªŒç»“æœï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚       â”œâ”€â”€ experiment1_ml-100k.csv
â”‚       â”œâ”€â”€ experiment1_ml-100k.json
â”‚       â”œâ”€â”€ experiment2_ml-100k.csv
â”‚       â”œâ”€â”€ experiment2_ml-100k.json
â”‚       â”œâ”€â”€ experiment3_ml-100k.csv
â”‚       â””â”€â”€ experiment3_ml-100k.json
â”‚
â”œâ”€â”€ ğŸ“š æ–‡æ¡£å±‚
â”‚   â”œâ”€â”€ README.md                   # æœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ CLOUD_GPU_GUIDE.md          # äº‘ç«¯éƒ¨ç½²æŒ‡å—ï¼ˆAutoDL/Colabï¼‰
â”‚   â””â”€â”€ EXPERIMENTS.md              # å®éªŒè®¾è®¡è¯¦è§£ï¼ˆå¯é€‰ï¼‰
â”‚
â””â”€â”€ ğŸ”§ é…ç½®å±‚
    â”œâ”€â”€ requirements.txt            # Pythonä¾èµ–
    â””â”€â”€ .gitignore
```

**ä»£ç ç»Ÿè®¡**ï¼š
- **æ€»ä»£ç é‡**ï¼š~2,500è¡Œ
- **æ ¸å¿ƒæ¨¡å—**ï¼š
  - `models.py`: 600è¡Œï¼ˆ5ä¸ªæ¨¡å‹å®ç°ï¼‰
  - `feature_engineering.py`: 650è¡Œï¼ˆç‰¹å¾å·¥ç¨‹pipelineï¼‰
  - `trainer.py`: 370è¡Œï¼ˆè®­ç»ƒå™¨ + Top-Kæ‰¹é‡è¯„ä¼°ï¼‰
  - `data_loader.py`: 670è¡Œï¼ˆæ•°æ®åŠ è½½ + è´Ÿæ ·æœ¬é‡‡æ ·ï¼‰
  - `hybrid_ranker.py`: 400è¡Œï¼ˆæ··åˆç²¾æ’æ¶æ„ï¼‰

---

## ğŸ› ï¸ æŠ€æœ¯ç»†èŠ‚

### è´Ÿæ ·æœ¬é‡‡æ ·ç­–ç•¥

```python
# è®­ç»ƒé˜¶æ®µï¼šéšæœºè´Ÿé‡‡æ ·ï¼ˆ1:1æ­£è´Ÿæ¯”ï¼‰
negative_item = np.random.randint(1, self.num_items + 1)
while negative_item in user_items:  # æ‹’ç»å·²äº¤äº’ç‰©å“
    negative_item = np.random.randint(1, self.num_items + 1)

# è¯„ä¼°é˜¶æ®µï¼š1æ­£æ ·æœ¬ + 99è´Ÿæ ·æœ¬
candidates = [positive_item] + sample_negatives(user, 99)
```

### æ³¨æ„åŠ›æœºåˆ¶å®ç°

```python
# DIN Candidate-aware Attention
attention_input = torch.cat([
    keys,                    # å†å²ç‰©å“åµŒå…¥
    query_expanded,          # å€™é€‰ç‰©å“åµŒå…¥
    keys * query_expanded,   # é€å…ƒç´ ä¹˜æ³•ï¼ˆç‰¹å¾äº¤å‰ï¼‰
    keys - query_expanded    # é€å…ƒç´ å·®å€¼ï¼ˆç›¸ä¼¼åº¦æ–¹å‘ï¼‰
], dim=-1)  # [B, L, 4*dim]

attention_scores = MLP(attention_input).squeeze(-1)  # [B, L]
attention_weights = softmax(attention_scores, mask=keys_mask)
user_interest = sum(attention_weights * keys)  # [B, dim]
```

### æŸå¤±å‡½æ•°ä¸ä¼˜åŒ–

```python
# BCEWithLogitsLossï¼ˆæ•°å€¼ç¨³å®šï¼‰
criterion = nn.BCEWithLogitsLoss()
loss = criterion(logits, labels)  # è‡ªåŠ¨sigmoid

# Adamä¼˜åŒ–å™¨ + L2æ­£åˆ™
optimizer = Adam(params, lr=1e-3, weight_decay=1e-5)

# æ¢¯åº¦è£å‰ªï¼ˆé˜²æ­¢çˆ†ç‚¸ï¼‰
loss.backward()
torch.nn.utils.clip_grad_norm_(model.parameters(), max_norm=5.0)
optimizer.step()
```

### GPUä¼˜åŒ–æŠ€æœ¯

```python
# 1. DataLoaderä¼˜åŒ–
NUM_WORKERS = 20          # CPUæ ¸å¿ƒæ•°-4
PREFETCH_FACTOR = 6       # é¢„åŠ è½½6æ‰¹æ•°æ®
pin_memory = True         # é”é¡µå†…å­˜åŠ é€Ÿä¼ è¾“

# 2. Top-Kè¯„ä¼°æ‰¹é‡åŒ–
# ä¼˜åŒ–å‰ï¼šbatch=1ï¼ˆé€ç”¨æˆ·æ¨ç†ï¼‰ï¼ŒGPUåˆ©ç”¨ç‡<10%
# ä¼˜åŒ–åï¼šbatch=32Ã—100=3200ï¼ˆæ‰¹é‡æ¨ç†ï¼‰ï¼ŒGPUåˆ©ç”¨ç‡>40%

# 3. å¤šGPUå¹¶è¡Œ
if torch.cuda.device_count() > 1:
    model = nn.DataParallel(model)  # 3x RTX 4090
```

---

## ğŸ“– ä½¿ç”¨åœºæ™¯

### å­¦æœ¯ç ”ç©¶

- âœ… **è®ºæ–‡å¤ç°**ï¼šDIN/GRU4Rec/SASRec/NARMå®Œæ•´å®ç°ï¼Œå¯ç”¨äºå¯¹æ¯”å®éªŒ
- âœ… **ç®—æ³•æ”¹è¿›**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºä¿®æ”¹æ³¨æ„åŠ›æœºåˆ¶ã€æŸå¤±å‡½æ•°
- âœ… **æ¶ˆèåˆ†æ**ï¼šæä¾›å®Œæ•´çš„æ¶ˆèå®éªŒæ¨¡æ¿

### å·¥ä¸šè½åœ°

- âœ… **ç‰¹å¾å·¥ç¨‹æ¨¡æ¿**ï¼š30+ç»´ç‰¹å¾å¯ç›´æ¥è¿ç§»åˆ°ç”µå•†/è§†é¢‘æ¨è
- âœ… **æ··åˆç²¾æ’å‚è€ƒ**ï¼šDIN+LightGBMæ¶æ„é€‚ç”¨äºç²¾æ’åœºæ™¯
- âœ… **æ€§èƒ½ä¼˜åŒ–å®è·µ**ï¼šDataLoaderã€Top-Kæ‰¹é‡åŒ–ã€å¤šGPUè®­ç»ƒ

### é¢è¯•å‡†å¤‡

- âœ… **é¡¹ç›®å±•ç¤º**ï¼šå®Œæ•´pipelineå±•ç°å…¨æ ˆèƒ½åŠ›
- âœ… **æ·±åº¦é—®ç­”**ï¼šä»æ•°å­¦å…¬å¼åˆ°ä»£ç å®ç°ï¼Œå¯æ·±å…¥è®²è§£
- âœ… **é—®é¢˜æ€è€ƒ**ï¼šè´Ÿæ ·æœ¬é‡‡æ ·ã€æ¨¡å‹å¯¹æ¯”ã€æ¶ˆèåˆ†æä½“ç°æ€ç»´æ·±åº¦

---

## ğŸŒŸ é¡¹ç›®ä»·å€¼

### ç†è®ºæ·±åº¦

| ç»´åº¦ | ä½“ç° |
|------|------|
| **æ¨¡å‹ç†è§£** | ä»KDDè®ºæ–‡å…¬å¼æ‰‹å†™DINæ³¨æ„åŠ›ï¼Œç†è§£candidate-aware vs self-attention |
| **æ¨ªå‘å¯¹æ¯”** | ç³»ç»Ÿå¯¹æ¯”5ä¸ªåºåˆ—æ¨¡å‹ï¼Œå‘ç°DINé€‚åˆçŸ­åºåˆ—ã€SASRecé€‚åˆTop-Kæ¨è |
| **æ¶ˆèåˆ†æ** | éªŒè¯æ—¶é—´è¡°å‡æ³¨æ„åŠ›æœ‰æ•ˆã€å¤šå¤´æ³¨æ„åŠ›åœ¨çŸ­åºåˆ—ä¸Šåæ•ˆæœ |

### å·¥ç¨‹èƒ½åŠ›

| ç»´åº¦ | ä½“ç° |
|------|------|
| **æ•°æ®å·¥ç¨‹** | è‡ªåŠ¨ä¸‹è½½æ•°æ®ã€ç‰¹å¾å·¥ç¨‹pipelineã€è´Ÿæ ·æœ¬é‡‡æ ·ç­–ç•¥ |
| **æ€§èƒ½ä¼˜åŒ–** | DataLoaderä¼˜åŒ–ï¼ˆworkers=20ï¼‰ã€Top-Kæ‰¹é‡åŒ–ï¼ˆGPUåˆ©ç”¨ç‡æå‡50%ï¼‰ |
| **å¤šGPUè®­ç»ƒ** | DataParallelå®ç°ã€æ¢¯åº¦åŒæ­¥ã€æ˜¾å­˜ç®¡ç† |
| **äº‘ç«¯éƒ¨ç½²** | AutoDL/Colabéƒ¨ç½²æŒ‡å—ã€æˆæœ¬æ§åˆ¶ï¼ˆÂ¥2-4/æ¬¡ï¼‰ |

### åˆ›æ–°æ€ç»´

| ç»´åº¦ | ä½“ç° |
|------|------|
| **æ··åˆç²¾æ’** | DINæ·±åº¦ç‰¹å¾ + LightGBMç‰¹å¾å·¥ç¨‹ï¼Œå…¼å…·æ•ˆæœä¸å¯è§£é‡Šæ€§ |
| **é—®é¢˜å®šä½** | å‘ç°SASRecé•¿åºåˆ—OOMã€GRU4Recæ€§èƒ½å´©æºƒï¼Œæå‡ºè§£å†³æ–¹æ¡ˆ |
| **trade-offåˆ†æ** | æ··åˆç²¾æ’AUCç•¥é™ä½†è®­ç»ƒæé€Ÿ9%ã€å¯è§£é‡Šæ€§æå‡ |

---

## ğŸ”— å‚è€ƒèµ„æº

### è®ºæ–‡

1. **[DIN]** Zhou et al. "Deep Interest Network for Click-Through Rate Prediction". *KDD 2018*.
2. **[GRU4Rec]** Hidasi et al. "Session-based Recommendations with Recurrent Neural Networks". *ICLR 2016*.
3. **[SASRec]** Kang & McAuley. "Self-Attentive Sequential Recommendation". *ICDM 2018*.
4. **[NARM]** Li et al. "Neural Attentive Session-based Recommendation". *CIKM 2017*.

### æ•°æ®é›†

- **MovieLens**: https://grouplens.org/datasets/movielens/

### ç›¸å…³é¡¹ç›®

- **RecBole**: https://github.com/RUCAIBox/RecBole ï¼ˆé€šç”¨æ¨èæ¡†æ¶ï¼‰
- **FuxiCTR**: https://github.com/reczoo/FuxiCTR ï¼ˆCTRé¢„æµ‹ï¼‰

---

## ğŸ“¬ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- **Issues**: [GitHub Issues](https://github.com/your-repo/issues)
- **Email**: sylvia1831@sjtu.edu.cn

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE)ã€‚

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®å’Œæ•°æ®é›†ï¼š
- **PyTorch**: æ·±åº¦å­¦ä¹ æ¡†æ¶
- **MovieLens**: GroupLens Researchæä¾›çš„æ¨èç³»ç»Ÿæ•°æ®é›†
- **RecBole**: æ¨èç³»ç»Ÿæ¡†æ¶çš„å‚è€ƒå®ç°
- **LightGBM**: é«˜æ•ˆçš„GBDTå®ç°
